var haste_document=function(){this.locked=false};haste_document.prototype.htmlEscape=function(a){return a.replace(/&/g,"&amp;").replace(/>/g,"&gt;").replace(/</g,"&lt;").replace(/"/g,"&quot;")};haste_document.prototype.load=function(a,d,b){var c=this;$.ajax("/documents/"+a,{type:"get",dataType:"json",success:function(e){c.locked=true;c.key=a;c.data=e.data;try{var g;if(b==="txt"){g={value:c.htmlEscape(e.data)}}else{if(b){g=hljs.highlight(b,e.data)}else{g=hljs.highlightAuto(e.data)}}}catch(f){g=hljs.highlightAuto(e.data)}d({value:g.value,key:a,language:g.language||b,lineCount:e.data.split("\n").length})},error:function(){d(false)}})};haste_document.prototype.save=function(a,c){if(this.locked){return false}this.data=a;var b=this;$.ajax("/documents",{type:"post",data:a,dataType:"json",contentType:"application/json; charset=utf-8",success:function(d){b.locked=true;b.key=d.key;var e=hljs.highlightAuto(a);c(null,{value:e.value,key:d.key,language:e.language,lineCount:a.split("\n").length})},error:function(d){try{c($.parseJSON(d.responseText))}catch(f){c({message:"Something went wrong!"})}}})};var haste=function(a,b){this.appName=a;this.$textarea=$("textarea");this.$box=$("#box");this.$code=$("#box code");this.$linenos=$("#linenos");this.options=b;this.configureShortcuts();this.configureButtons();if(!b.twitter){$("#box2 .twitter").hide()}};haste.prototype.setTitle=function(a){var b=a?this.appName+" - "+a:this.appName;document.title=b};haste.prototype.showMessage=function(c,b){var a=$('<li class="'+(b||"info")+'">'+c+"</li>");$("#messages").prepend(a);setTimeout(function(){a.slideUp("fast",function(){$(this).remove()})},3000)};haste.prototype.lightKey=function(){this.configureKey(["new","save"])};haste.prototype.fullKey=function(){this.configureKey(["new","duplicate","twitter","raw"])};haste.prototype.configureKey=function(a){var c,b=0;$("#box2 .function").each(function(){c=$(this);for(b=0;b<a.length;b++){if(c.hasClass(a[b])){c.addClass("enabled");return true}}c.removeClass("enabled")})};haste.prototype.newDocument=function(a){this.$box.hide();this.doc=new haste_document();if(!a){window.history.pushState(null,this.appName,"/")}this.setTitle();this.lightKey();this.$textarea.val("").show("fast",function(){this.focus()});this.removeLineNumbers()};haste.extensionMap={rb:"ruby",py:"python",pl:"perl",php:"php",scala:"scala",go:"go",xml:"xml",html:"xml",htm:"xml",css:"css",js:"javascript",vbs:"vbscript",lua:"lua",pas:"delphi",java:"java",cpp:"cpp",cc:"cpp",m:"objectivec",vala:"vala",sql:"sql",sm:"smalltalk",lisp:"lisp",ini:"ini",diff:"diff",bash:"bash",sh:"bash",tex:"tex",erl:"erlang",hs:"haskell",md:"markdown",txt:"",coffee:"coffee",json:"javascript",swift:"swift"};haste.prototype.lookupExtensionByType=function(b){for(var a in haste.extensionMap){if(haste.extensionMap[a]===b){return a}}return b};haste.prototype.lookupTypeByExtension=function(a){return haste.extensionMap[a]||a};haste.prototype.addLineNumbers=function(a){var c="";for(var b=0;b<a;b++){c+=(b+1).toString()+"<br/>"}$("#linenos").html(c)};haste.prototype.removeLineNumbers=function(){$("#linenos").html("&gt;")};haste.prototype.loadDocument=function(a){var b=a.split(".",2);var c=this;c.doc=new haste_document();c.doc.load(b[0],function(d){if(d){c.$code.html(d.value);c.setTitle(d.key);c.fullKey();c.$textarea.val("").hide();c.$box.show().focus();c.addLineNumbers(d.lineCount)}else{c.newDocument()}},this.lookupTypeByExtension(b[1]))};haste.prototype.duplicateDocument=function(){if(this.doc.locked){var a=this.doc.data;this.newDocument();this.$textarea.val(a)}};haste.prototype.lockDocument=function(){var a=this;this.doc.save(this.$textarea.val(),function(d,b){if(d){a.showMessage(d.message,"error")}else{if(b){a.$code.html(b.value);a.setTitle(b.key);var c="/"+b.key;if(b.language){c+="."+a.lookupExtensionByType(b.language)}window.history.pushState(null,a.appName+"-"+b.key,c);a.fullKey();a.$textarea.val("").hide();a.$box.show().focus();a.addLineNumbers(b.lineCount)}}})};haste.prototype.configureButtons=function(){var b=this;this.buttons=[{$where:$("#box2 .save"),label:"Save",shortcutDescription:"control + s",shortcut:function(c){return c.ctrlKey&&(c.keyCode===83)},action:function(){if(b.$textarea.val().replace(/^\s+|\s+$/g,"")!==""){b.lockDocument()}}},{$where:$("#box2 .new"),label:"New",shortcut:function(c){return c.ctrlKey&&c.keyCode===78},shortcutDescription:"control + n",action:function(){b.newDocument(!b.doc.key)}},{$where:$("#box2 .duplicate"),label:"Duplicate & Edit",shortcut:function(c){return b.doc.locked&&c.ctrlKey&&c.keyCode===68},shortcutDescription:"control + d",action:function(){b.duplicateDocument()}},{$where:$("#box2 .raw"),label:"Just Text",shortcut:function(c){return c.ctrlKey&&c.shiftKey&&c.keyCode===82},shortcutDescription:"control + shift + r",action:function(){window.location.href="/raw/"+b.doc.key}},{$where:$("#box2 .twitter"),label:"Twitter",shortcut:function(c){return b.options.twitter&&b.doc.locked&&c.shiftKey&&c.ctrlKey&&c.keyCode==84},shortcutDescription:"control + shift + t",action:function(){window.open("https://twitter.com/share?url="+encodeURI(window.location.href))}}];for(var a=0;a<this.buttons.length;a++){this.configureButton(this.buttons[a])}};haste.prototype.configureButton=function(a){a.$where.click(function(b){b.preventDefault();if(!a.clickDisabled&&$(this).hasClass("enabled")){a.action()}});a.$where.mouseenter(function(){$("#box3 .label").text(a.label);$("#box3 .shortcut").text(a.shortcutDescription||"");$("#box3").show();$(this).append($("#pointer").remove().show());$("#pointer").addClass("icon-arrow-up5")});a.$where.mouseleave(function(){$("#box3").hide();$("#pointer").hide()})};haste.prototype.configureShortcuts=function(){var a=this;$(document.body).keydown(function(b){var d;for(var c=0;c<a.buttons.length;c++){d=a.buttons[c];if(d.shortcut&&d.shortcut(b)){b.preventDefault();d.action();return}}})};$(function(){$("textarea").keydown(function(a){if(a.keyCode===9){a.preventDefault();var d="  ";if(document.selection){this.focus();var e=document.selection.createRange();e.text=d;this.focus()}else{if(this.selectionStart||this.selectionStart=="0"){var c=this.selectionStart;var b=this.selectionEnd;var f=this.scrollTop;this.value=this.value.substring(0,c)+d+this.value.substring(b,this.value.length);this.focus();this.selectionStart=c+d.length;this.selectionEnd=c+d.length;this.scrollTop=f}else{this.value+=d;this.focus()}}}})});